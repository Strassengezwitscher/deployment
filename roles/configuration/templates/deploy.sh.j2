#!/bin/bash

set -e

cd {{ project_path }}/{{ item.dir }}
git reset --hard
git pull
pip install -r requirements.txt
npm install
if [ -f gulpfile.js ]; then
	node_modules/gulp/bin/gulp.js build --production
fi
python strassengezwitscher/manage.py collectstatic --noinput
python strassengezwitscher/manage.py migrate --noinput
chown -R www-data:www-data {{ project_path }}/{{ item.dir }}
